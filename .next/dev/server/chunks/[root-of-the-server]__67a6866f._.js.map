{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/nadav.sorek/factory/projects/hederochel/lib/supabase/server.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\"\nimport { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\n// Admin client - uses service_role key\n// ONLY use in server-side code (API routes, server actions)\n// Bypasses Row Level Security - use with caution!\nexport function createAdminClient() {\n  return createClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.SUPABASE_SERVICE_ROLE_KEY!, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n\n// Server client with user session - for protected routes\n// Uses anon key but can access user session from cookies\nexport async function createServerClientWithCookies() {\n  const cookieStore = await cookies()\n\n  return createServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n    },\n  })\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;;;;AAKO,SAAS;IACd,OAAO,IAAA,yLAAY,gFAAwC,QAAQ,GAAG,CAAC,yBAAyB,EAAG;QACjG,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF;AAIO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAAoF;QAC3G,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;QACF;IACF;AACF"}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///Users/nadav.sorek/factory/projects/hederochel/app/api/users/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { createAdminClient } from \"@/lib/supabase/server\"\n\n// GET /api/users - List all users (admin operation)\n// This requires the service_role key because listing users\n// is a privileged operation in Supabase\n\nexport async function GET() {\n  try {\n    // Check if environment variables are set\n    if (!process.env.NEXT_PUBLIC_SUPABASE_URL || !process.env.SUPABASE_SERVICE_ROLE_KEY) {\n      return NextResponse.json(\n        {\n          error: \"Missing environment variables\",\n          hint: \"Make sure NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY are set in .env.local\",\n        },\n        { status: 500 },\n      )\n    }\n\n    // Use admin client for privileged operations\n    const supabase = createAdminClient()\n\n    // List all users - requires service_role key\n    const {\n      data: { users },\n      error,\n    } = await supabase.auth.admin.listUsers()\n\n    if (error) {\n      console.error(\"Error listing users:\", error)\n      return NextResponse.json({ error: error.message }, { status: 500 })\n    }\n    \n    const userIds = users.map((user) => user.id)\n    const { data: profiles, error: profilesError } = await supabase\n      .from(\"profiles\")\n      .select(\"id, full_name, role\")\n      .in(\"id\", userIds)\n\n    if (profilesError) {\n      console.error(\"Error fetching profiles:\", profilesError)\n      // Continue without profile data rather than failing completely\n    }\n\n    const profilesMap = new Map(profiles?.map((profile) => [profile.id, profile]) || [])\n    \n\n    // IMPORTANT: Only return safe fields!\n    // Never expose sensitive data like password hashes\n    const safeUsers = users.map((user) => {\n      const profile = profilesMap.get(user.id)\n      return {\n        id: user.id,\n        email: user.email,\n        created_at: user.created_at,\n        last_sign_in_at: user.last_sign_in_at,\n        email_confirmed_at: user.email_confirmed_at,\n        // Profile data from public.profiles table\n        full_name: profile?.full_name || null,\n        role: profile?.role || null,\n        user_metadata: {\n          name: user.user_metadata?.name || null,\n          avatar_url: user.user_metadata?.avatar_url || null,\n        },\n      }\n    })\n\n    return NextResponse.json({\n      users: safeUsers,\n      count: safeUsers.length,\n    })\n  } catch (error) {\n    console.error(\"Unexpected error:\", error)\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAMO,eAAe;IACpB,IAAI;QACF,yCAAyC;QACzC,IAAI,iFAAyC,CAAC,QAAQ,GAAG,CAAC,yBAAyB,EAAE;YACnF,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,OAAO;gBACP,MAAM;YACR,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,6CAA6C;QAC7C,MAAM,WAAW,IAAA,gJAAiB;QAElC,6CAA6C;QAC7C,MAAM,EACJ,MAAM,EAAE,KAAK,EAAE,EACf,KAAK,EACN,GAAG,MAAM,SAAS,IAAI,CAAC,KAAK,CAAC,SAAS;QAEvC,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,wBAAwB;YACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,MAAM,UAAU,MAAM,GAAG,CAAC,CAAC,OAAS,KAAK,EAAE;QAC3C,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,SACpD,IAAI,CAAC,YACL,MAAM,CAAC,uBACP,EAAE,CAAC,MAAM;QAEZ,IAAI,eAAe;YACjB,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,+DAA+D;QACjE;QAEA,MAAM,cAAc,IAAI,IAAI,UAAU,IAAI,CAAC,UAAY;gBAAC,QAAQ,EAAE;gBAAE;aAAQ,KAAK,EAAE;QAGnF,sCAAsC;QACtC,mDAAmD;QACnD,MAAM,YAAY,MAAM,GAAG,CAAC,CAAC;YAC3B,MAAM,UAAU,YAAY,GAAG,CAAC,KAAK,EAAE;YACvC,OAAO;gBACL,IAAI,KAAK,EAAE;gBACX,OAAO,KAAK,KAAK;gBACjB,YAAY,KAAK,UAAU;gBAC3B,iBAAiB,KAAK,eAAe;gBACrC,oBAAoB,KAAK,kBAAkB;gBAC3C,0CAA0C;gBAC1C,WAAW,SAAS,aAAa;gBACjC,MAAM,SAAS,QAAQ;gBACvB,eAAe;oBACb,MAAM,KAAK,aAAa,EAAE,QAAQ;oBAClC,YAAY,KAAK,aAAa,EAAE,cAAc;gBAChD;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,OAAO;YACP,OAAO,UAAU,MAAM;QACzB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}